<!DOCTYPE html><html lang="en-us" >


<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.4.0 for Hugo" />
  

  
  










  







  
  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    
      
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media="print" onload="this.media='all'">
    
  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Fabian Gunzinger" />

  
  
  
    
  
  <meta name="description" content=" " />

  
  <link rel="alternate" hreflang="en-us" href="https://fabiangunzinger.github.io/post/makefiles/" />

  
  
  
    <meta name="theme-color" content="#1565c0" />
  

  
  
    
    <script src="/js/mathjax-config.js"></script>
  

  

  <link rel="stylesheet" href="/css/vendor-bundle.min.f1ecf783c14edc00c9320c205831ad8e.css" media="print" onload="this.media='all'">

  
  
  
    
    

    
    
    
    
      
      
    
    
    

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.1/build/styles/github.min.css" crossorigin="anonymous" title="hl-light" media="print" onload="this.media='all'">
          <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.1/build/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" media="print" onload="this.media='all'" disabled>
        
      
    

    
    
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.25fc9de39ceb731d249ee970a49347ca.css" />

  



  


  


  




  
  
  

  

  
    <link rel="manifest" href="/manifest.webmanifest" />
  

  <link rel="icon" type="image/png" href="/media/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_32x32_fill_lanczos_center_3.png" />
  <link rel="apple-touch-icon" type="image/png" href="/media/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_180x180_fill_lanczos_center_3.png" />

  <link rel="canonical" href="https://fabiangunzinger.github.io/post/makefiles/" />

  
  
  
  
  
  
  
  
    
    
  
  

  
  
    
    
  
  <meta property="twitter:card" content="summary" />
  
    <meta property="twitter:site" content="@wowchemy" />
    <meta property="twitter:creator" content="@wowchemy" />
  
  <meta property="og:site_name" content="" />
  <meta property="og:url" content="https://fabiangunzinger.github.io/post/makefiles/" />
  <meta property="og:title" content="Makefiles | " />
  <meta property="og:description" content=" " /><meta property="og:image" content="https://fabiangunzinger.github.io/media/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_512x512_fill_lanczos_center_3.png" />
    <meta property="twitter:image" content="https://fabiangunzinger.github.io/media/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_512x512_fill_lanczos_center_3.png" /><meta property="og:locale" content="en-us" />
  
    
      <meta
        property="article:published_time"
        content="2021-08-23T00:00:00&#43;00:00"
      />
    
    <meta property="article:modified_time" content="2021-08-23T00:00:00&#43;00:00">
  

  


    






  




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://fabiangunzinger.github.io/post/makefiles/"
  },
  "headline": "Makefiles",
  
  "datePublished": "2021-08-23T00:00:00Z",
  "dateModified": "2021-08-23T00:00:00Z",
  
  "author": {
    "@type": "Person",
    "name": "Fabian Gunzinger"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "",
    "logo": {
      "@type": "ImageObject",
      "url": "https://fabiangunzinger.github.io/media/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_192x192_fill_lanczos_center_3.png"
    }
  },
  "description": " "
}
</script>

  

  

  

  





  <title>Makefiles | </title>
</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " data-wc-page-id="75f908b1f4a0c4ddba1293ed5b324a35" >

  
  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.9e9fa4b2ccd29f9edfae161d14d2effd.js"></script>

  


<aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#" aria-label="Close"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control"
        aria-label="Search...">
        
      </div>

      
      

      

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>



  <div class="page-header">
    












<header class="header--fixed">
  <nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
    <div class="container-xl">

      
      <div class="d-none d-lg-inline-flex">
        <a class="navbar-brand" href="/"></a>
      </div>
      

      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="Toggle navigation">
      <span><i class="fas fa-bars"></i></span>
      </button>
      

      
      <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
        <a class="navbar-brand" href="/"></a>
      </div>
      

      
      
      <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

        
        <ul class="navbar-nav d-md-inline-flex">
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="/#about"><span>Home</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link " href="/research/"><span>Research</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link  active" href="/post/"><span>Blog</span></a>
          </li>

          
          

        

          
        </ul>
      </div>

      <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

        
        
          
        

        
        
        <li class="nav-item">
          <a class="nav-link js-search" href="#" aria-label="Search"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        
        
        
        <li class="nav-item dropdown theme-dropdown">
          <a href="#" class="nav-link" data-toggle="dropdown" aria-haspopup="true" aria-label="Display preferences">
            <i class="fas fa-moon" aria-hidden="true"></i>
          </a>
          <div class="dropdown-menu">
            <a href="#" class="dropdown-item js-set-theme-light">
              <span>Light</span>
            </a>
            <a href="#" class="dropdown-item js-set-theme-dark">
              <span>Dark</span>
            </a>
            <a href="#" class="dropdown-item js-set-theme-auto">
              <span>Automatic</span>
            </a>
          </div>
        </li>
        

        
        

      </ul>

    </div>
  </nav>
</header>


  </div>

  <div class="page-body">
    
    
    

    <article class="article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1>Makefiles</h1>

  
  <p class="page-subtitle">Cheatsheet</p>
  

  
    


<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    Aug 23, 2021
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    4 min read
  </span>
  

  
  
  
  

  
  

</div>

    





  
</div>



  <div class="article-container">

    <div class="article-style">
      <ul>
<li>
<p>A makefile is a data base that tells the <code>make</code> utilit how to recompile a
system. In the default use case, <code>$: make &lt;filename&gt;</code> checks whether <code>filename</code> is out of date and, if so, recompiles it. In the way I use makefiles, <code>$: make &lt;rule&gt;</code>
executes a predefined rule to accomplish a certain task like cleaning a
particular dataset.</p>
</li>
<li>
<p>Rules consist of a target (the name of a file to be modified), prerequisites
(other files on which the target depends on), and commands to be run in order
to update the traget based on changes in the prerequisites.</p>
</li>
<li>
<p>A rule tells <code>make</code> when a target is out of date and how to update it. A
target is out of date if it doesn&rsquo;t exist or is older then one of its
prerequisite files.</p>
</li>
<li>
<p><code>$: make</code> executes the first specified rule, <code>$: make &lt;rule&gt;</code> executes a
particular rule.</p>
</li>
<li>
<p>A normal prerequisite makes both an <em>order statement</em> and a <em>dependency statement</em>:
the order statement ensures that all commands needed to produce the
prerequisete are fully executed before any commands to produce the target,
while the dependency statement ensures that the target is updated every time a
prerequisite changes. Occasionally, we want a prerequisite to invoke the order without the
dependency statement (i.e. target is not udpated when the prerequisite
changes, but when target is being updated, then the prerequisite commandas are
run first). We can do this by writing the rule as <code>target: normal-prerequisites | order-only-prerequisites</code>.</p>
</li>
<li>
<p><code>make</code> does its work in two phases: during the <em>read-in</em> phase, it reads the
makefile and internalises variables and rules to construct a dependency graph
of all targets and their prerequisies; during the <em>target-update</em> phase, it
determines what rules to update in what order and executes the commandas to do
so.</p>
</li>
<li>
<p>As a result, variable and function expansion can happen either <em>immediately</em>
(during the read-in phase) or <em>deferred</em> (after the read-in phase), and gives
rise to two flavours of variables: <em>recursively expanded variables</em>, defined by
<code>varname = value</code> are expanded at the time the variable is substituted during
the target-update phase. Before that point, <code>varname</code> contains the content of
<code>value</code> verbatim (e.g. if <code>value</code> is <code>$(othervar)</code>, then that last string is
the value of <code>varname</code>). In contrast, <em>simply expanded variables</em>, defined by
<code>varname := value</code> is expanded immediately when the variable is defined during
the read-in phase (and <code>varname</code> would be bound to the value of <code>othervar</code> in
the above example).</p>
</li>
<li>
<p>To define a variable containing all csv files in a directory, do <code>csvs := $(wildcard *.csv)</code>. The <code>wildcard</code> function is needed here so that the
wildcard gets expanded during function creation (as opposed to creating the
variable with value <code>*.csv</code>). I could also create a list
containing the same files but with a parquet extensions like so: `parqs :=
$(patsubst %.csv,%.parquet,$(wildcard *.csv)).</p>
</li>
<li>
<p>Automatic variables: <code>$^</code> is a list of all prerequisites, <code>$@</code> is the target,
<code>$&lt;</code> the first prerequisite.</p>
</li>
<li>
<p>If a target is an action to be performed rather than a file to be updated,
then it&rsquo;s called a <code>phony target</code>. In this case, telling <code>make</code> that we&rsquo;re
using a phone target explicitly by prepending the rule with a line like
<code>.PHONY : nameofrule</code> is useful for two reasons: <code>make</code> doesn&rsquo;t think of a
file called <code>nameofrule</code> as the target (which, if it did, would mean that our
rule never gets run because it has no prerequisites so that <code>make</code> would think
of <code>nameofrule</code> as always up to date) and it doesn&rsquo;t check for implicit
commands to update the target, which improves performance.</p>
</li>
<li>
<p>Commands begin with a tab and, unless specified otherwise, are executed by
<code>bin/sh</code>. You can set a different shell by changing the value of the <code>SHELL</code>
variable (I usually use <code>SHELL := /bin/bash</code>. Each line that begines with a tab and appears within a rule context
(anything between the start of one rule and another) is interpreted as a
command and sent to the shell.</p>
</li>
<li>
<p>The only thing <code>make</code> does with commands is to check for <code>\</code> before newline,
and for variables to expand (if you want <code>$</code> to appear in the command, use
<code>$$</code>). To prevent <code>make</code> from echoing a command, prepend it with <code>@</code>.</p>
</li>
<li>
<p>Prepend a command with <code>-</code> if you want <code>make</code> to continue regardless of
errors. This can be useful for commands like <code>-rm tempfile.csv</code>, where you
probaby want to continue even if the file didn&rsquo;t exist and could thus not be
removed.</p>
</li>
</ul>
<h2 id="best-practices">Best practices</h2>
<p>Define a phony target:</p>
<pre><code>.PHONY: clean
clean:
    rm *.csv
</code></pre>
<p>Make <code>$: make</code> run all rules:</p>
<pre><code>.PHONY: all
all : rule1 rule2

.PHONY: rule1
rule1:
    mkdir hello

.PHONY: rule2
rule2:
    rm -rf hello
</code></pre>

    </div>

    




<div class="article-tags">
  
  <a class="badge badge-light" href="/tag/tools/">tools</a>
  
  <a class="badge badge-light" href="/tag/cheatsheet/">cheatsheet</a>
  
</div>





















  </div>
</article>
  </div>

  <div class="page-footer">
    
    
    <div class="container">
      <footer class="site-footer">

  



  

  

  

  
  






  
  <p class="powered-by copyright-license-text">
    © 2023 Fabian Gunzinger
  </p>
  




  <p class="powered-by">
    
    
    
      
      
      
      
      
      
      Published with <a href="https://wowchemy.com/?utm_campaign=poweredby" target="_blank" rel="noopener">Wowchemy</a> — the free, <a href="https://github.com/wowchemy/wowchemy-hugo-themes" target="_blank" rel="noopener">open source</a> website builder that empowers creators.
    
  </p>
</footer>

    </div>
    
  </div>

      

    
    <script src="/js/vendor-bundle.min.9592335d574f7a97010f99b90ad0f310.js"></script>

    
    
    
      
      

      
      

      

      
        
        <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.1/build/highlight.min.js" integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin="anonymous"></script>
        
        
        <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.1/build/languages/r.min.js" crossorigin="anonymous"></script>
        
        <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.2.1/build/languages/latex.min.js" crossorigin="anonymous"></script>
        
      

    

    
    
    

    
    

    
    
    
      
      <script id="search-hit-fuse-template" type="text/x-template">
        <div class="search-hit" id="summary-{{key}}">
          <div class="search-hit-content">
            <div class="search-hit-name">
              <a href="{{relpermalink}}">{{title}}</a>
              <div class="article-metadata search-hit-type">{{type}}</div>
              <p class="search-hit-description">{{snippet}}</p>
            </div>
          </div>
        </div>
      </script>
      
        <script src="https://cdn.jsdelivr.net/gh/krisk/Fuse@v3.2.1/dist/fuse.min.js" integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/gh/julmot/mark.js@8.11.1/dist/jquery.mark.min.js" integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin="anonymous"></script>
      
    

    
    

    
    
    
    

    
    
      
      
      
      
      
      
      
    

    

    
    
    
    <script id="page-data" type="application/json">{"use_headroom":true}</script>

    
    
      <script src="/js/wowchemy-headroom.c251366b4128fd5e6b046d4c97a62a51.js" type="module"></script>
    
    
    
    
    
    
    
      
      
    
    
    <script src="/en/js/wowchemy.min.df578bcc2e7fa600fcfe490e187ce35e.js"></script>

    
    
    
    
    
    






</body>
</html>
